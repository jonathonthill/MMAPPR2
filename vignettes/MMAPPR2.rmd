An Introduction to MMAPPR2
============================================================

Kyle Johnsen, Nathaniel Jenkins, Jonathon Hill

Brigham Young University, Provo, Utah, USA
____________________________________________________________


## Getting Started

#### Installing Dependencies
You must first install Ensembl VEP like so:
```{bash installVEP}
git clone https://github.com/Ensembl/ensembl-vep.git
cd ensembl-vep
perl INSTALL.pl -a ac -s my_species
```

This installs the most recent VEP and cache for your desired species, which is what MMAPPR2 expects by default.
If you depart from the installation shown here, see [Ensembl's instructions](http://www.ensembl.org/info/docs/tools/vep/script/vep_download.html#installer)
and make sure any differences are accounted for in the
[`VEPFlags`](#configure-vepflags-object) object.

#### Reference Genome
Variant calling requires a reference genome, which you can create from your reference file like this:
```{r refGenome eval=FALSE}
refGenome <- gmapR::GmapGenome('file', create=TRUE)
```

**Make sure your reference genome is the one installed by VEP, i.e., the most recent one on Ensembl**

## Running MMAPPR2

Do stuff


## Advanced Configuration

#### Configure VEPFlags Object
MMAPPR2 uses the ensemblVEP Bioconductor package to predict the effect of variants in the peak region. 
To customize this process, you'll need to configure a `VEPFlags` object. The following is what MMAPPR2 uses if
the user doesn't provide their own `VEPFlags` object:
Note that 
```{r vepFlags}
library(ensemblVEP)
vepFlags <- VEPFlags(flags = list(
    format = 'vcf',  # <-- this is necessary
    vcf = FALSE,  # <-- as well as this
    species = 'danio_rerio',
    database = FALSE,
    cache = TRUE,
    filter_common = TRUE,
    coding_only = TRUE,  # assuming RNA-seq data
    most_severe = TRUE  # only keeps worst consequence per variant TODO: not working?
))
  
```

#### BiocParallel Configuration
MMAPPR2 simply uses the default `bpparam` registered. You can change this (for example, if BiocParallel isn't working correctly) with the `BiocParallel::register` command. For example:
```{r bpparam}
library(BiocParallel)
register(SerialParam())
register(MultiCoreParam())
```

The last param registered becomes the default.

#### Whole-genome Sequencing (WGS)
It would probably work. Mess with parameters like minDepth.
